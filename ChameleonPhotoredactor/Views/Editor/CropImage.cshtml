@{
    ViewData["Title"] = "Editor Page";
    Layout = "~/Views/Shared/_layoutCropImage.cshtml";
}

<div class="content-container_Full">

    <form asp-controller="FullEditor" asp-action="FullEditor" method="post" enctype="multipart/form-data">
        
    </form>
    <div class="image_container">
        @if (ViewBag.ImagePath != null)
        {
            <img src="@ViewBag.ImagePath" alt="Uploaded Image" style="max-width: 500px; border-radius: 10px;" />
        }
        else if (ViewBag.ImageData != null)
        {
            var base64 = Convert.ToBase64String(ViewBag.ImageData);
            var imgSrc = String.Format("data:{0};base64,{1}", ViewBag.ImageType, base64);
            <img src="@imgSrc" alt="Uploaded Image" id="editable_image" style="max-width: 500px; border-radius: 10px;" />
        }
        else
        {
            <p>No image selected. Please upload one.</p>
        }
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {

        const exposureVal = @((ViewBag.InitialExposure ?? 0).ToString(System.Globalization.CultureInfo.InvariantCulture));
        const contrastVal = @((ViewBag.InitialContrast ?? 0).ToString(System.Globalization.CultureInfo.InvariantCulture));
        const saturationVal = @((ViewBag.InitialSaturation ?? 0).ToString(System.Globalization.CultureInfo.InvariantCulture));

        const exposure = 1 + (exposureVal / 100);
        const contrast = 1 + (contrastVal / 100);
        const saturation = 1 + (saturationVal / 100);

        const image = document.getElementById("editable_image");
        const exportLink = document.getElementById("export-nav-link");
        const imageEditId = @(ViewBag.ImageEditId ?? 0);

        if (exportLink && imageEditId > 0) {
            const exportUrl = '@Url.Action("FullExport", "FullExport")' + '/' + imageEditId;
            exportLink.href = exportUrl;
        }

        if (image) {
            const filterString = `brightness(${exposure}) contrast(${contrast}) saturate(${saturation})`;
            image.style.filter = filterString;
        }

        function getAntiCSRFToken() {
            const tokenInput = document.querySelector('input[name="__RequestVerificationToken"]');
            return tokenInput ? tokenInput.value : '';
        }
    });
</script>